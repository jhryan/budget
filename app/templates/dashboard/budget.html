{% extends 'dashboard/base.html' %}
{% set active_page = 'dashboard.budget' -%}

{% block dashboard_content %}
    <div class="budget-toolbar text-muted p-1">
        <span data-toggle="modal" data-target="#addCategoryGroupModal">
            <span data-feather="plus-circle"></span>
            Category Group
        </span>
    </div>
    <table class="table table-sm">
        <thead>
            <tr>
                <th scope="col">Category</th>
                <th scope="col">Budgeted</th>
                <th scope="col">Activity</th>
                <th scope="col">Available</th>
            </tr>
        </thead>
        {% if category_groups %}
            {% for category_group in category_groups %}
                <tbody>
                    <tr class="thead-light">
                        <th>
                            <span class="expander" data-target=".budget-category-{{ category_group.id }}" data-toggle="collapse" aria-expanded="true">
                                <span data-feather="chevron-down"></span>
                            </span>
                            <span data-toggle="modal" data-target="#editCategoryGroupModal">
                                {{ category_group.name }}
                                <span data-toggle="modal" data-target="#addCategoryModal" data-feather="plus-circle"></span>
                            </span>
                        </th>
                        <th>$0.00</td>
                        <th>$0.00</td>
                        <th>$0.00</td>
                    </tr>
                    {% for category in category_group.children %}
                        <tr class="budget-category-{{ category_group.id }} collapse show">
                            <th scope="row">{{ category.name }}</th>
                            <td>$0.00</td>
                            <td>$0.00</td>
                            <td>$0.00</td>
                        </tr>
                    {% endfor %}
                </tbody>
            {% endfor %}
        {% endif %}
    </table>

    <!-- 'Add Category Group' modal  -->
    <div class="modal fade" id="addCategoryGroupModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                {% include 'dashboard/add_category_group_form.html' %}
            </div>
        </div>
    </div>

    <!-- 'Add Category' modal  -->
    <div class="modal fade" id="addCategoryModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                {% include 'dashboard/add_category_form.html' %}
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}

    {{ super() }}

    <script>
        var form_default_url;

        $(function () {
            $('#addCategoryModal').on('shown.bs.modal', function (event) {
                var category_group = $(event.relatedTarget).text().trim();
                form_default_url = $(event.target).find('form:first').attr('action');
                $(event.target).find('form:first').attr('action', $(event.target).find('form:first').attr('action') + '/' + category_group + '/add_category');
            });

            $('#addCategoryModal').on('hidden.bs.modal', function (event) {
                $(event.target).find('form:first').attr('action', form_default_url);
            });
        });

    </script>
{% endblock %}